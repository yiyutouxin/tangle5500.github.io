---
layout:     post
title:      CMD 批处理
subtitle:   
date:       2020-7-2
author:     Tangle
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - CMD
---



# 批处理

## 变量

| 命令          | 作用     |
| ------------- | -------- |
| set demo=文本 | 赋值变量 |
| echo %demo%   | 输出变量 |

## 注释

| 命令                         | 作用                           |
| ---------------------------- | ------------------------------ |
| :: 注释内容                  | 单行注释                       |
| rem 注释                     | 单行注释，不关闭回显时可以看到 |
| goto 233<br>注释内容<br>:233 | 多行注释                       |

## 获取管理员权限

| 命令                                                         | 作用           |
| ------------------------------------------------------------ | -------------- |
| %1 mshta vbscript:CreateObject("Shell.Application").ShellExecute("cmd.exe","/c %~s0 ::","","runas",1)(window.close)&&exit | 获取管理员权限 |

## 跳转

| 命令              | 作用 |
| ----------------- | ---- |
| goto 233<br/>:233 | 跳转 |

## 循环

| 参数 | 作用             |
| ---- | ---------------- |
| /d   | 仅对目录执行命令 |
| /r   | 参数后可以带路径 |
| /l   | (起始,步长,结束) |
| /f   | 操作文件         |
| /q   | 不需要确认       |

| 命令                                | 作用                   |
| ----------------------------------- | ---------------------- |
| for %%i in (1,2,3) do echo %%i      | 遍历元祖               |
| for /d %%i in (C:\*.*) do @echo %%i | 打印 C盘根目录所有路径 |
| for /r C:\ %%i in (1) do @echo %%i  | 打印 C盘所有路径和 1   |
| for /l %%i in (1,1,5) do @echo %%i  | 步长为 0 可以无限循环  |

## 判断

| 参数       | 作用               |
| ---------- | ------------------ |
| errorlevel | 上行错误代码返回值 |

| 命令                                                         | 作用                       |
| ------------------------------------------------------------ | -------------------------- |
| if exist 1.txt start 1.txt                                   | 如果文件存在执行后面的命令 |
| if 1 == 1 start 1.txt                                        | 如果条件成立执行后面的命令 |
| xcopy C:\1.txt D:\\<br>if errorlevel 1 (echo 拷贝失败)else errorlevel 0 (echo 拷贝成功)else (echo 233) | 拷贝判断                   |

## 比较运算符

| 命令       | 作用   |
| ---------- | ------ |
| ==         | 等于   |
| not 1 == 1 | 不等于 |
| lss        | <      |
| leq        | <=     |
| gtr        | >      |
| geq        | \>=    |

## 延时

| 命令      | 作用                |
| --------- | ------------------- |
| TIMEOUT 3 | 延时 3 秒任意键退出 |

## 文件操作

| 命令 | 作用     |
| ---- | -------- |
| >    | 清空写入 |
| \>>  | 追加写入 |

## 路径

| 命令     | 作用            |
| -------- | --------------- |
| /d       | 切换指定目录    |
| %0       | 批处理自身文件  |
| %~d0     | 批处理自身盘符  |
| %~dp0    | 批处理自身路径  |
| %windir% | 代表 C:\Windows |

## 特殊命令

| 命令     | 作用                     |
| -------- | ------------------------ |
| @        | 代表不显示当前行命令自身 |
| echo off | 关闭打印                 |
| pause    | 暂停                     |

## vbs 执行 bat

| 语法                                                 | 作用             |
| ---------------------------------------------------- | ---------------- |
| set ws=CreateObject("wscript.shell")                 | 获取 shell 对象  |
| set fso = createobject("scripting.filesystemobject") | 获取创建文件对象 |
| set file = fso.createtextfile("temp.bat",true)       | 创建文件         |
| wscript.sleep 1000                                   | 延时 1 秒        |
| fso.DeleteFile("temp.bat")                           | 删除文件         |
| path = fso.GetFolder(".").Path                       | 获取当前路径     |

``` vb
set ws=CreateObject("wscript.shell")
set fso=createobject("scripting.filesystemobject")
set file=fso.createtextfile("temp.bat",true)
path = fso.GetFolder(".").Path
file.writeline("del """+path+"\temp.bat""")
file.close
ws.run "temp.bat",0
```

## python 执行 bat

```python
import subprocess

bat_name='temp.bat'
f = open(bat_name,'w')

f.write(r'''pause
del temp.bat
''')

f.close()

subprocess.call(bat_name, shell=True, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
```

# 实例

## 禁用网卡

| 命令                                                         | 作用     |
| ------------------------------------------------------------ | -------- |
| netsh interface set interface name="无线网络连接" admin=DISABLED | 禁用网卡 |
| netsh interface set interface name="无线网络连接" admin=ENABLED | 开启网卡 |

```
if "%1"=="h" goto begin 
start mshta vbscript:createobject("wscript.shell").run("""%~nx0"" h",0)(window.close)&&exit 
:begin
%1 mshta vbscript:CreateObject("Shell.Application").ShellExecute("cmd.exe","/c %~s0 ::","","runas",1)(window.close)&&exit
netsh interface set interface name="无线网络连接" admin=DISABLED
```

## dll 注册

32位系统

```
%1 mshta vbscript:CreateObject("Shell.Application").ShellExecute("cmd.exe","/c %~s0 ::","","runas",1)(window.close)&&exit
copy dm.dll %windir%\system32\
regsvr32 %windir%\system32\dm.dll
```

64位系统

```
copy dm.dll %windir%\SysWOW64\
%1 mshta vbscript:CreateObject("Shell.Application").ShellExecute("cmd.exe","/c %~s0 ::","","runas",1)(window.close)&&exit
regsvr32 %windir%\SysWOW64\dm.dll
```

32位系统解除服务器注册

```
%1 mshta vbscript:CreateObject("Shell.Application").ShellExecute("cmd.exe","/c %~s0 ::","","runas",1)(window.close)&&exit
regsvr32 /u %windir%\system32\dm.dll
```

64位系统解除服务器注册

```
%1 mshta vbscript:CreateObject("Shell.Application").ShellExecute("cmd.exe","/c %~s0 ::","","runas",1)(window.close)&&exit
regsvr32 /u %windir%\SysWOW64\dm.dll
```

## 清空回收站

```
for %%i in (A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z) do rd /s /q %%i:\$Recycle.Bin
```

xp 系统

```
for %%i in (A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z) do rd /s /q %%i:\$Recycle
```

## 修改 ip地址与 dns

ip 地址

| 命令                                                         | 作用                                             |
| ------------------------------------------------------------ | ------------------------------------------------ |
| netsh int ip set address "本地连接" stat 192.168.1.1 255.255.255.0 192.168.1.1 1 | 修改 ip地址，子网掩码 ，网关。也可以不修改网关。 |
| netsh int ip set address "本地连接" dhcp                     | 自动获取 ip地址                                  |

dns

| 命令                                            | 作用           |
| ----------------------------------------------- | -------------- |
| netsh int ip set dns "本地连接" stat 8.8.8.8    | 清空并设置 dns |
| netsh int ip add dns "本地连接" 114.114.114.114 | 添加 dns       |
| netsh int ip set dns "本地连接" dhcp            | 自动获取 dns   |
| ipconfig /flushdns                              | 清空 dns缓存   |

| dns             | 作用       |
| --------------- | ---------- |
| 8.8.8.8         | 谷歌服务器 |
| 114.114.114.144 | 广告拦截   |
| 114.114.114.119 | 病毒拦截   |
| 114.114.114.110 | 色情拦截   |

## U盘屏蔽与恢复

| 属性 | 作用                 |
| ---- | -------------------- |
| /v   | 指定子项下的名称     |
| /t   | 指定项值的数据类型   |
| /d   | 指定新注册表的值     |
| /f   | 不用询问信息直接添加 |

U盘屏蔽

```
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\USBSTOR" /v Start /t reg_dword /d 4 /f
```

U盘恢复

```
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\USBSTOR" /v Start /t reg_dword /d 3 /f
```

## 锁屏

```
rundll32.exe user32.dll,LockWorkStation
```
