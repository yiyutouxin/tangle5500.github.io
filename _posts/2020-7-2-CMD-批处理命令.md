---
layout:  post
title:   CMD 批处理命令
date:    2020-7-2
author:  Tangle
catalog: true
tags:
    - CMD
---

# 常用

```
@        # 不显示当前行命令自身
echo off # 关闭打印
pause    # 暂停
```

# 注册模块

```
regsvr32 Comctl32.ocx    # 注册
regsvr32 /u Comctl32.ocx # 取消注册
system32                 # 32位操作系统目录
SysWOW64                 # 64位操作系统目录
```

```
cd /d %~dp0
copy Comctl32.ocx %windir%\SysWOW64\
regsvr32 %windir%\SysWOW64\Comctl32.ocx
```

# 延时

```
ping 127.0.0.1 -n 3 >nul

timeout 3 /nobreak
```

# 变量

```
set var = 233 # 赋值变量
echo %var%    # 输出变量
```

# 注释

## 单行注释

```
:: text  # 单行注释
rem text # 单行注释
```

## 多行注释

```
goto 233
text
:233
```

# 获取管理员权限

```
%1 mshta vbscript:CreateObject("Shell.Application").ShellExecute("cmd.exe","/c %~s0 ::","","runas",1)(window.close)&&exit
```

# 循环

```
goto 233
text
:233
```

```
# 参数

%%i      # 文件完整信息
%%~di    # 保留文件所在驱动器信息
%%~pi    # 保留文件所在路径信息
%%~ni    # 保留文件名信息
%%~xi    # 保留文件后缀信息
%%~zi    # 保留文件大小信息
%%~ti    # 保留文件修改时间信息
%%~dpi   # 保留文件所在驱动器和所在路径信息
%%~nxi   # 保留文件名及后缀信息
%%~pnxi  # 保留文件所在路径及文件名和后缀信息
%%~dpni  # 保留文件驱动器、路径、文件名信息
%%~dpnxi # 保留文件驱动器、路径、文件名、后缀信息

/d       # 仅对目录执行命令
/r       # 参数后可以带路径
/l       # (起始,步长,结束)
/f       # 操作文件
/q       # 不需要确认
```

```
for %%i in ("%cd%\*.mp4") do echo "%cd%\%%~ni.mp4" # 遍历所有 mp4 文件
for %%i in (1,2,3) do @echo %%i                    # 遍历元祖
for /d %%i in (C:\*.*) do @echo %%i                # 遍历根目录所有路径
for /r C:\ %%i in (1) do @echo %%i                 # 遍历所有路径和 1
for /l %%i in (1,1,5) do @echo %%i                 # 步长为 0 可以无限循环
```

# 判断

```
if exist 1.txt start 1.txt # 如果文件存在执行后面的命令
if 1==2 (echo 1) else if .py==.bat (echo .py) else (echo 233)
```

## 拷贝判断

```
errorlevel # 上行错误代码返回值
```

```
xcopy C:\1.txt D:\
if errorlevel 1 (echo 拷贝失败)else errorlevel 0 (echo 拷贝成功)else (echo 233)
```

# 关系运算符

```
==         # 等于
not 1 == 1 # 不等于
lss        # <
leq        # <=
gtr        # >
geq        # >=
```

# 路径

```
%cd%          # 当前工作路径
%0            # 当前文件路径
%~d0          # 当前文件盘符
%~dp0         # 当前文件目录
%windir%      # Windows 目录
%USERPROFILE% # 用户目录
```

# 对话框

```
mshta vbscript:msgbox("内容",64,"标题")(window.close)
```

# vbs 执行 bat

```
wscript.sleep 1000         # 延时 1 秒
fso.DeleteFile("temp.bat") # 删除文件
```

```vb
set s=CreateObject("wscript.shell")              # 获取 shell 对象
set f=createobject("scripting.filesystemobject") # 获取创建文件对象
set file=f.createtextfile("temp.bat",true)       # 创建文件
path = f.GetFolder(".").Path                     # 获取当前路径
file.writeline("del """+path+"\temp.bat""")
file.close
s.run "temp.bat",0
```

# python 执行 bat

```
stdin=subprocess.PIPE  # 输入
stdout=subprocess.PIPE # 输出
stderr=subprocess.PIPE # 错误
```

```python
import subprocess

bat_name='temp.bat'
f = open(bat_name,'w')

f.write(r'''pause
del temp.bat
''')

f.close()

subprocess.call(bat_name, shell=True, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
```

# 教程

<https://www.yiibai.com/batch_script/batch_script_operators.html>
