---
layout:     post
title:      CMD 批处理命令
subtitle:   
date:       2020-7-2
author:     Tangle
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - CMD
---

# 常用

```
@        # 不显示当前行命令自身
echo off # 关闭打印
pause    # 暂停
```

# 延时

```
echo CreateObject("Scripting.FileSystemObject").DeleteFile(WScript.ScriptFullName) >%Temp%\Wait.vbs
echo wscript.sleep 1000 >>%Temp%\Wait.vbs
start /wait %Temp%\Wait.vbs
```

# 变量

```
set var = 233 # 赋值变量
echo %var%    # 输出变量
```

# 注释

## 单行注释

```
:: text  # 单行注释
rem text # 单行注释
```

## 多行注释

```
goto 233
text
:233
```

# 获取管理员权限

```
%1 mshta vbscript:CreateObject("Shell.Application").ShellExecute("cmd.exe","/c %~s0 ::","","runas",1)(window.close)&&exit
```

# 跳转

```
goto 233
text
:233
```

# 循环

<http://blog.sina.com.cn/s/blog_63041bb80102wn8h.html>

```
/d # 仅对目录执行命令
/r # 参数后可以带路径
/l # (起始,步长,结束)
/f # 操作文件
/q # 不需要确认
```

```
%%i

```

```
for %%i in ("*.mp4") do echo "%%~ni.mp4" # 遍历所有 mp4 文件
for %%i in (1,2,3) do @echo %%i          # 遍历元祖
for /d %%i in (C:\*.*) do @echo %%i      # 遍历根目录所有路径
for /r C:\ %%i in (1) do @echo %%i       # 遍历所有路径和 1
for /l %%i in (1,1,5) do @echo %%i       # 步长为 0 可以无限循环
```

# 判断

```
if exist 1.txt start 1.txt # 如果文件存在执行后面的命令
if 1 == 1 start 1.txt      # 如果条件成立执行后面的命令
```

## 拷贝判断

```
errorlevel # 上行错误代码返回值
```

```
xcopy C:\1.txt D:\
if errorlevel 1 (echo 拷贝失败)else errorlevel 0 (echo 拷贝成功)else (echo 233)
```

# 比较运算符

```
==         # 等于
not 1 == 1 # 不等于
lss        # <
leq        # <=
gtr        # >
geq        # \>=
```

# 路径

```
%0       # 自身文件路径
%~d0     # 自身盘符
%~dp0    # 自身路径
%windir% # C:\Windows
```

# vbs 执行 bat

```
wscript.sleep 1000         # 延时 1 秒
fso.DeleteFile("temp.bat") # 删除文件
```

```vb
set ws=CreateObject("wscript.shell")               # 获取 shell 对象
set fso=createobject("scripting.filesystemobject") # 获取创建文件对象
set file=fso.createtextfile("temp.bat",true)       # 创建文件
path = fso.GetFolder(".").Path                     # 获取当前路径
file.writeline("del """+path+"\temp.bat""")
file.close
ws.run "temp.bat",0
```

# python 执行 bat

```python
import subprocess

bat_name='temp.bat'
f = open(bat_name,'w')

f.write(r'''pause
del temp.bat
''')

f.close()

subprocess.call(bat_name, shell=True, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
```
